"use strict";function _defineProperty(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}!function(e,n,o){function a(e){for(var n=window.location.search.substring(1),o=n.split("&"),a=0;a<o.length;a++){var t=o[a].split("=");if(t[0]==e)return t[1]}return""}function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,a=n.createElement("div");a.innerHTML=e,a.style.cssText="min-width:124px;padding:0 8px;opacity: 0.8;height: 40px;background:rgba(34,34,38,1);color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 35%;left:50%;transform: translateX(-50%);z-index: 999999;font-size: 16px;",n.getElementById("order-payment").appendChild(a),setTimeout(function(){a.style.webkitTransition="-webkit-transform 0.5s ease-in, opacity 0.5s ease-in",a.style.opacity="0",setTimeout(function(){n.getElementById("order-payment")&&n.getElementById("order-payment").removeChild(a)},500)},o)}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,n='\n      <div class="loading_warp" id="order-payment-loading">\n        <div class="icon_box">\n          <img class="rotating" src="'+y+'/icon-paying.png"/>\n        </div>\n        <div class="pay_msg">查询中...</div>\n        <img class="pay_other" src="'+y+'/pay-other.png"/>\n      </div>\n    ';o(".orderpayment_dialog").append(n),setTimeout(function(){o("#order-payment-loading").remove()},e)}function s(){var e=d("api_env")||"",n="https://mall.csdn.net/",o=/^beta|test|loc[a-z]*/;return e.match(o)?n="https://test-mall.csdn.net/":e.match(/^pre-|pre[a-z]*/)&&(n="https://pre-mall.csdn.net/"),n}function d(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(n);return null!=o?unescape(o[2]):null}function c(e,a){QRCode?a.pay_url&&(o("#ordertip_qr_code").html(""),o("#ordertip_notify").hide(),o("#pay_btn").attr("href",a.pay_url),new QRCode(n.getElementById("ordertip_qr_code"),{text:a.pay_url,width:145,height:145})):console.warn("qrcode脚本不存在，请检查！")}function r(){g("pay_error","获取失败,点击重试","code_2")}function l(){g("pay_time_out","点击重新获取","")}function p(){g("pay_error","已扫码<br>请在手机端操作","")}function _(){i(),setTimeout(function(){v.activeGoodsId==v.goodsInfo.goods_id?(t("支付成功","1500"),setTimeout(function(){f?(v.close(),f()):window.location.reload()},1500)):(t("余额充值成功，使用余额支付完成购买吧","1500"),o(".orderpayment_c_l_goodsitem").trigger("click"))},1500)}function g(e,n,a){o("#ordertip_notify").show().html('<img class="pay_icon" src="https://csdnimg.cn/release/download/images/'+e+'.png"/><span class="pay_tip">'+n+"</span>"),o("#ordertip_qr_code").html('<img src="https://csdnimg.cn/public/static/img/csdn-userimg250.gif" width="145" height="145"/>'),"pay_time_out"==e?o("#ordertip_notify .pay_icon,#ordertip_notify .pay_tip").on("click",function(){v.getPayCode()}):o("#ordertip_notify .pay_icon,#ordertip_notify .pay_tip").off("click")}function m(){this.checkBalacneGoods=!1,this.goodsInfo={},this.balanceList={},this.balanceGoodsInfo={},this.activeGoodsId="",this.isUseBalance=!0,this.errType="",this.reportExt={},this.navList=[],this.payMethods=[],this.price=0,this.payUrl="",this.params={},this._cart=null,this.show_params={},h=this}var u="https://g.csdnimg.cn/order-payment/",y=u+"3.0.2/images",h=null,f=null;!function(e){var o=n.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=e,n.getElementsByTagName("head")[0].appendChild(o)}("https://g.csdnimg.cn/order-payment/3.0.2/order-payment.css"),m.prototype={constructor:m,close:function(){o("#order-payment-box").remove()},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return window.csdn.cart?window.csdn.cartClass?void this.init(e):void console.error("请使用 user-ordercart 3.0.0 及以上版本"):void console.error("user-ordercart 脚本不存在，请检查！")},init:function(e){this._cart=new window.csdn.cartClass,this.sale=e.sale_source||a("sale_source"),this.reportExt=e.report_ext||{},"function"==typeof e.get_pay_success_callback&&(f=e.get_pay_success_callback,delete e.get_pay_success_callback),this.show_params=e,this.getGoodsInfo(e,function(e){h.goodsInfo=e,h.goodsCodeData(e.new_price,e.available_amount),h.getGoodsShowList()},!1)},bindEvents:function(){o(n).off("click",".orderpayment_dialog .user_balance").on("click",".orderpayment_dialog .user_balance",function(){if(o(".orderpayment_dialog .user_balance").hasClass("disable"))return void(h.isUseBalance=!1);o(".orderpayment_dialog .user_balance").hasClass("active")?(o(".orderpayment_dialog .user_balance").removeClass("active"),h.isUseBalance=!1):(o(".orderpayment_dialog .user_balance").addClass("active"),h.isUseBalance=!0),h.goodsCodeData(h.goodsInfo.new_price,h.goodsInfo.available_amount),h.changePriceHtml(h.price),h.getPayCode(h.goodsInfo)}),o(n).off("click","#pay_btn").on("click","#pay_btn",function(e){h._cart.quickBuy({params:{product_id:h.goodsInfo.product_id,goods_id:h.goodsInfo.goods_id,flag:h.goodsInfo.flag,is_use_balance:2},get_pay_success_callback:function(e){200==e.code&&!1===e.data.need_third_pay&&_()},error_function:function(e){400103012==e.status&&o(".orderpayment_item.active").trigger("click"),console.warn(e.errorMessage)}})}),o(n).on("click",".orderpayment_header_btn",function(e){o("#order-payment-box").remove()}),o(n).on("click",".orderpayment_item",function(e){var n=JSON.parse(o(this).attr("data-goods")||"{}");if(o(this).has("active"))return o(this).addClass("active").siblings().removeClass("active"),void h.getGoodsInfo(n,function(e){"balance"===n.type?(h.checkBalacneGoods=!0,h.balanceGoodsInfo=e):(h.goodsInfo=e,h.checkBalacneGoods=!1,e.available_amount>0&&(h.isUseBalance=!0)),h.activeGoodsId=e.goods_id,h.goodsCodeData(e.new_price,e.available_amount),o(".orderpayment_dialog .commodity_box").html("").append(h.setPayPriceHtml()),o(".orderpayment_dialog .scan_code").html("").append(h.setPaylistHtml())})})},initDialog:function(){this.bindEvents(),this.renderDialog()},setGoodsListHtml:function(){for(var e="",n=0;n<this.balanceList.length;n++)e+='<div class="orderpayment_c_l_bitem orderpayment_item '+(this.activeGoodsId==this.balanceList[n].ext.goodsId?"active":"")+"\" data-goods='"+JSON.stringify({goods_id:this.balanceList[n].ext.goodsId,product_id:this.balanceList[n].ext.productId,flag:this.balanceList[n].ext.flag,type:"balance"})+"'>\n          <span class=\"orderpayment_c_l_b_tips "+(this.balanceList[n].ext.activityContent?"":"none")+'">'+(this.balanceList[n].ext.activityContent||"")+'</span>\n          <div class="orderpayment_c_l_b_price"><span>¥</span>'+this.balanceList[n].ext.price+'</div>\n          <div class="orderpayment_c_l_b_dis">'+(this.balanceList[n].ext.activityDiscountDesc||"")+'</div>\n          <div class="orderpayment_c_l_b_activity"><p>'+(this.balanceList[n].ext.activityDesc||"")+"</p></div>\n        </div>";return e+'<div class="orderpayment_c_l_goodsitem orderpayment_c_l_bitem orderpayment_item '+(this.activeGoodsId==this.goodsInfo.goods_id?"active":"")+"\" data-goods='"+JSON.stringify({goods_id:this.goodsInfo.goods_id,product_id:this.goodsInfo.product_id,flag:this.goodsInfo.flag})+'\'>\n        <span class="orderpayment_c_l_b_tips" >暂无优惠</span>\n          <div class="orderpayment_c_l_b_price"><span>¥</span>'+this.goodsInfo.old_price+'</div>\n          <div class="orderpayment_c_l_b_activity"><p>直接购买<br />无限次学习</p></div>\n      </div>'},setPaylistHtml:function(){var e=h.checkBalacneGoods?h.balanceGoodsInfo:h.goodsInfo,n=[];e.payTypeList&&e.payTypeList.forEach(function(e){"unionpay"!==e.name&&n.push(e)});for(var o="",a=0;a<n.length;a++)o+='<img class="icon_item '+n[a].name+'" src='+JSON.stringify(n[a].image)+' alt="img">';return o+'<span class="pay_intro">扫码支付</span>'},setPayPriceHtml:function(){var e=h.checkBalacneGoods?h.balanceGoodsInfo:h.goodsInfo;return'<ul class="commodity_desc">\n                    <li class="amount_actually">\n                      实付金额<span class="num">¥ <b>'+h.price+"</b></span><em>原价<i>"+e.old_price+'</i>元</em>\n                    </li>\n                    \n                    <li class="gift '+(e.discount_msg?"block":"none")+'">\n                      <img src="'+y+'/enjoy.png" alt="">\n                      <span>'+e.discount_msg+'</span>\n                    </li>\n\n                    <li class="user_balance '+(e.available_amount>0?h.isUseBalance?"active":"":"disable")+" "+(19===e.flag?"none":"")+'" >\n                      <img src="'+y+'/unchecked.png" alt="" class="unchecked">\n                      <img src="'+y+'/checked.png" alt="" class="checked">\n                      钱包余额 <b class="num">'+e.available_amount+'</b>\n                      <div class="balance_tips_box">\n                        <img src="'+y+'/help.png" alt="" class="help">\n                        <span class="balance_tips">\n                          <i class="chat"></i>\n                          <b>抵扣说明：</b>\n                          <em>1、余额是钱包充值的虚拟货币，按照1:1的比例进行支付金额的抵扣；</em>\n                          <em>2、余额无法直接购买下载，可以购买VIP、C币套餐及课程；</em>\n                        </span>\n                      </div>\n                    </li>\n                    <div class="btn '+(0!=h.price?"none":"block")+'" id="pay_btn">确定支付</div>\n                  </ul>'},renderDialog:function(){this.createMask();var n=this.setGoodsListHtml(),a=this.setPaylistHtml(),t=this.setPayPriceHtml(),i='<div id="order-payment" class="order-payment">\n          <div class="orderpayment_dialog">\n              <div class="orderpayment_header">\n                <div class="orderpayment_header_title">扫码支付</div>\n                <span class="orderpayment_header_btn"> + </span>\n              </div>\n              <div class="orderpayment_content">\n                <div class="orderpayment_c_goodsinfo">\n                  <div class="orderpayment_c_goods_warp">\n                    <img class="orderpayment_c_goods_img" src="'+(this.goodsInfo.product_pic||"https://img-home.csdnimg.cn/images/20210910025238.png")+'" />\n                  </div>\n                  <div class="orderpayment_c_goods_t"><p>'+this.goodsInfo.name+'</p></div>\n                </div>\n                <div class="orderpayment_c_goodslist">\n                  '+n+'\n                </div>\n                <div class="orderpayment_c_activity">'+(this.goodsInfo.activityDesc||"")+'</div>\n                <div class="orderpayment_paybox">\n                  <div class="recharge_mode '+(0!=h.price?"block":"visnone")+'">\n                    <div class="recharge_mode_qr_code" id="ordertip_qr_code">\n                      <img class="loading" src="'+y+'/checked.png" width="50" height="50">\n                    </div>\n                    <div id="ordertip_notify" class="pay_notify"></div>\n                    <p class="scan_code">\n                      '+a+'\n                    </p>\n                  </div>\n\n                  <div class="commodity_box">\n                    '+t+'\n                  </div>\n                </div>\n              </div>\n          </div>\n          <div class="orderpayment_mask"></div>\n      </div>\n      ',s=o(i);o("#order-payment-box").append(s),e.report&&window.csdn.report.viewCheck()},createMask:function(){var e=n.createElement("div");e.id="order-payment-box",n.body.appendChild(e)},getGoodsShowList:function(){o.ajax({url:s()+"mp/mallorder/api/internal/goods/showListV2?showType=balancePopup",type:"GET",dataType:"json",contentType:"application/json",async:!1,xhrFields:{withCredentials:!0},success:function(e){if(e.data)if(h.balanceList=e.data.balancePopup||[],h.goodsInfo.available_amount>=h.goodsInfo.new_price)h.activeGoodsId=h.goodsInfo.goods_id,h.checkBalacneGoods=!1,h.initDialog(),h.getPayCode();else{var n={};h.balanceList.forEach(function(e){1==e.ext.default&&(n=e.ext||{})}),h.activeGoodsId=n.goodsId,h.getGoodsInfo({goods_id:n.goodsId,product_id:n.productId,flag:n.flag},function(e){h.checkBalacneGoods=!0,h.balanceGoodsInfo=e,h.goodsCodeData(e.new_price,e.available_amount),h.initDialog()})}else console.warn("获取商品列表失败")},error:function(e){console.warn("获取商品列表失败")}})},getGoodsInfo:function(e,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];o.ajax({url:s()+"mp/mallorder/api/internal/goods/getGoodsInfo",type:"GET",dataType:"json",data:e,contentType:"application/json",async:!1,xhrFields:{withCredentials:!0},success:function(e){200==e.code&&e.data?(19===e.data.flag&&(h.isUseBalance=!1),n&&n(e.data),h.changePriceHtml(h.price),a&&h.getPayCode(e.data)):console.warn("获取商品信息失败")},error:function(e){console.warn("获取商品信息失败")}})},goodsCodeData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.isUseBalance){var o=e-n<0?0:(100*e-100*n)/100;this.price=Number(o).toFixed(2)}else this.price=Number(e)},changePriceHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Number(e)<=0?(o(".orderpayment_dialog .recharge_mode").addClass("visnone"),o(".orderpayment_dialog #pay_btn").addClass("show").removeClass("none")):(o(".orderpayment_dialog .recharge_mode").removeClass("visnone"),o(".orderpayment_dialog #pay_btn").removeClass("show").addClass("none")),o(".orderpayment_dialog .amount_actually .num b").html(e)},getPayCode:function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.checkBalacneGoods?h.balanceGoodsInfo:h.goodsInfo,o=a("sale_source"),t=(e={product_id:n.product_id,goods_id:n.goods_id,flag:n.flag,sale_source:h.sale,report_ext:h.reportExt,is_use_balance:Number(h.isUseBalance),coupon_key:n.coupon_key,use_cache:!0},_defineProperty(e,"sale_source",o),_defineProperty(e,"success_function",c),_defineProperty(e,"error_function",r),_defineProperty(e,"timeout_function",l),_defineProperty(e,"payment_function",p),_defineProperty(e,"get_pay_success_callback",_),e);h._cart.qrPay(Object.assign(h.show_params,t))},findDefaultGood:function(){var e=h.balanceList.find(function(e){return 1===e.ext.default})||{ext:{}};return Object.assign({goods_id:e.ext.goodsId||"",flag:e.ext.flag||"",product_id:e.ext.productId||""},e)}};var v=new m;window.orderPaymeny=v,window.csdn.userOrderPayment={show:v.show.bind(v),close:v.close.bind(v)}}(window.csdn=window.csdn||{},document,jQuery);