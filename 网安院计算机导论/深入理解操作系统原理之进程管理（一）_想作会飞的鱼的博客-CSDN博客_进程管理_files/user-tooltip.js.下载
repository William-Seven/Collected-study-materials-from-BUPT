"use strict";!function(e,s,t){var n,o="https://g.csdnimg.cn/user-tooltip/2.5/",i={company:"<img src="+o+"images/icon-company.png />",domainGrey:"<img src="+o+"images/icon-domain-grey.png />",domain:"<img src="+o+"images/icon-domain.png />",vip:"<img src="+o+"images/icon-vip.png />",writer:"<img src="+o+"images/icon-writer.png />"},a={getUserProfileUrl:"https://me.csdn.net/api/external/user/getUserProfile",checkFollowUrl:"https://me.csdn.net/api/relation/check",doFollowUrl:"https://mp-action.csdn.net/interact/wrapper/pc/fans/v1/api/follow",doUnfollowUrl:"https://mp-action.csdn.net/interact/wrapper/pc/fans/v1/api/unFollow",ref:"miniprofile",defaultUserProfile:{username:"yanlinpu",avatarurl:"https://profile.csdnimg.cn/1/1/B/1_yanlinpu",vip:!1,expert:!1,nickname:"木林森001",fans_num:"2万",identity:[{name:"专家"},{name:"版主"}],medal:[{type:"203",codename:"111",image:"https://g.csdnimg.cn/static/user-medal/1024huodong.svg"}]}},l={ask:"ASK",bbs:"BBS",me:"ME",download:"DOWNLOAD",blog_detail:"BLOG_DETAIL",blog:"BLOG",live:"LIVE"};if(void 0===e.csdn&&(e.csdn={}),!jQuery)return!1;!function(e){var t=s.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,s.getElementsByTagName("head")[0].appendChild(t)}(o+"user-tooltip.css"),e.csdn.userTooltip=function(o){function r(){_[f].flag&&(t("#csdn-userTooltip .person_deliver").mouseover(function(){t(this).hasClass("person_deliver_letter")&&t(this).html("取&nbsp;&nbsp;&nbsp;消")}),t("#csdn-userTooltip .person_deliver").mouseout(function(){t(this).hasClass("person_deliver_letter")&&t(this).html("已关注")})),t("#csdn-userTooltip .person_deliver").click(function(){var s,o;if(b){var i=t(this);if(n||(n=e.location.hostname.indexOf("blog.csdn.net")>0?e.location.href.indexOf("/article/details")>=0?l.blog_detail:l.blog:l[e.location.hostname.split(".")[0]]?l[e.location.hostname.split(".")[0]]:"ME"),0==_[f].flag){if(!i.hasClass("person_deliver_letter_un"))return!1;s=a.doFollowUrl,t.ajax({type:"post",url:s,dataType:"json",xhrFields:{withCredentials:!0},contentType:"application/json",crossDomain:!0,data:JSON.stringify({follow:f,source:n,username:b}),success:function(s){200==parseInt(s.code)&&(i.html("已关注").removeClass("person_deliver_letter_un").addClass("person_deliver_letter"),i.mouseover(function(){i.html("取&nbsp;&nbsp;&nbsp;消")}),i.mouseout(function(){i.html("已关注")})),e.csdn&&e.csdn.watchBtnChange&&e.csdn.watchBtnChange(1,f),_[f].flag=!0,_[f].followClass="person_deliver person_deliver_letter",_[f].followStr="已关注"}})}else o=a.doUnfollowUrl,t.ajax({type:"post",url:o,xhrFields:{withCredentials:!0},contentType:"application/json",crossDomain:!0,data:JSON.stringify({follow:f,source:n,username:b}),dataType:"json",success:function(s){200==parseInt(s.code)&&(i.html("关注").removeClass("person_deliver_letter").addClass("person_deliver_letter_un"),i.unbind("mouseover"),i.unbind("mouseout")),e.csdn&&e.csdn.watchBtnChange&&e.csdn.watchBtnChange(0,f),_[f].flag=!1,_[f].followClass="person_deliver person_deliver_letter_un",_[f].followStr="关注"}})}else e.location.href="https://passport.csdn.net/"})}function c(e){var s,t=e.offset(),n=t.left,o=t.top,i=e.width(),a=e.height(),l=e[0].getBoundingClientRect(),r={};return l&&Number(l.top,10)<162?(s="left:"+(n-50+i/2)+"px;top:"+(o+a+15)+"px",r.isBottom=!0):(s="left:-999999999px;top:"+(o-165)+"px",r.realPos={left:n-50+i/2,top:o}),r.position=s,r}function d(){t("#csdn-userTooltip").remove()}o&&t.extend(a,o);var p,m,u,f,h,v,g={},_={},w="",y=!1,T='<svg id="csdnc-m-blank" viewBox="0 0 1024 1024" width="100%" height="100%" fill="#ccc"><path d="M516.266311 77.945505a8.788601 8.788601 0 0 0-8.532622 0L121.461878 292.455629a8.319307 8.319307 0 0 0-4.351637 7.252729v424.583284c0 2.986418 1.663861 5.75952 4.351637 7.252729l386.271811 214.510124a8.788601 8.788601 0 0 0 8.532622 0l386.271811-214.510124a8.319307 8.319307 0 0 0 4.351637-7.252729V299.708358a8.319307 8.319307 0 0 0-4.351637-7.252729L516.266311 77.945505z m37.671528-67.066412l386.314473 214.552788a85.027581 85.027581 0 0 1 43.900342 74.276477v424.583284c0 30.802766-16.809266 59.216399-43.943005 74.276477l-386.27181 214.552788c-26.024498 14.462795-57.808516 14.462795-83.875678 0l-386.314473-214.552788a85.027581 85.027581 0 0 1-43.900342-74.276477V299.708358c0-30.802766 16.809266-59.216399 43.943005-74.276477L470.019498 10.879093c26.024498-14.462795 57.808516-14.462795 83.875677 0z"></path></svg>';s.domain="csdn.net";var b=function(e){for(var t=s.cookie.split("; "),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e&&"UD"==e)return decodeURIComponent(o[1]);if(o[0]==e)return decodeURI(o[1])}}("UserName");t(s).on("mouseenter","img[username], #csdn-userTooltip",function(s){function o(e,s,n,o,i,l,r,c,d,p,m,u,h,v,g,_){g=g||"<a href='javascript:void(0)' class='person_deliver person_deliver_letter_un' style='float:right;'>关注</a>";var w="<div id='csdn-userTooltip' style='"+u.position+"' data-mod='popu_60' class='tracking-ad"+(u.isBottom?" csdn-userTooltip-pos":" csdn-userTooltip-default")+"'><div class='person-info-div clearfix'><dt class='touxiang'><img src='"+e+"'></dt><div class='csdn-left-info'><dd class='person_info clearfix'><em class='name"+(s?" name_short":"")+(o?" vipname":"")+"'>"+n+"</em>"+v+"<span class='person-age'>码龄"+_+"年</span></dd>"+d+h+"</div></div><div class='follow-div clearfix'>"+(l?"<em class='fav'>粉丝 "+l+"</em>":"")+g+"<a class='visoter'  target='_blank'href='http://me.csdn.net/"+f+"?ref="+a.ref+"'>访问主页</a><a class='visoter' target='_blank' href='https://im.csdn.net/im/main.html?userName="+f+"'>私信</a></div>";if(t("body").append(w),u.realPos){var y=t("#csdn-userTooltip"),T=y.height(),b=u.realPos.left,C=u.realPos.top-T-35;y.css({left:b,top:C})}}function l(){t("#csdn-userTooltip").length&&t("#csdn-userTooltip").remove(),f=h.attr("username");var s,n,l,d,p,m,C,x,U,k,B,j,D="";if(!(u.closest("#csdn-userTooltip").length<=0))return!1;t("#csdn-userTooltip").remove(),_[f]?(s=_[f].followClass,n=_[f].followStr,l=_[f].avatarurl,d=_[f].nickname,p=_[f].isVip,m=_[f].hasDomain,C=_[f].isBlogWriter,x=_[f].favsCount,U=_[f].interestname,k=_[f].huistr,j=_[f].age,D=c(h),v=p?"<span class='icon_vip'>"+i.vip+"</span>":"",v+=C?"<span class='icon_writer'>"+i.writer+"</span>":"",w=m?"<li class='has-domain'>"+i.domain+"<a href='https://"+m+".blog.csdn.net'>"+m+".blog.csdn.net</a></li>":"<li class='medal no-domain'>"+i.domainGrey+"暂未设置自定义域名</li>",w="<dd class='csdn-domain'>"+w+"</dd>",b?(s&&n&&(B="<a href='javascript:void(0)' class='"+s+"'>"+n+"</a>"),b===f&&(B=""),o(l,U,d,p,C,x,s,n,k,void 0,y,D,w,v,B,j),r()):(o(l,U,d,p,C,x,s,n,k,void 0,y,D,w,v,B,j),t("#csdn-userTooltip .person_deliver").click(function(){e.location.href="https://passport.csdn.net/"}))):t.ajax({type:"get",url:a.getUserProfileUrl+"?username="+f,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(s){var n,l,d,p,m,u,f,C,x,U,k,j,F,P="",L="",N="",O="",S=!1;if(200===Number(s.code,10)){if(n=s.data||a.defaultUserProfile,!(j=n.username))return!1;if(l=n.avatarurl,d=n.nickname||j,F=n.years,p=n.fans_num,m=n.vip,u=n.domain,f=n.expert,C=n.medal?n.medal:[],x=C.length,x>0&&(S=!0),v=m?"<span class='icon_vip'>"+i.vip+"</span>":"",v+=f?"<span class='icon_writer'>"+i.writer+"</span>":"",w=u?"<li class='has-domain'>"+i.domain+"<a href='https://"+u+".blog.csdn.net'>"+u+".blog.csdn.net</a></li>":"<li class='medal no-domain'>"+i.domainGrey+"暂未设置自定义域名</li>",w="<dd class='csdn-domain'>"+w+"</dd>",S){C.length>99999?(U=99999,k=!0):U=C.length;for(var E=0;E<U;E++)N+="<li class='medal' title='"+C[E].codename+"'><img src='"+C[E].image+"' alt='胸章'></li>";k&&(N+='<li class="medal medal-icon">'+T+C.length+"</li>"),N="<dd class='medals'><ul>"+N+"</ul></dd>"}else N="<li class='medal no-medals'>一个勋章都没有...</li>",N="<dd class='medals'><ul>"+N+"</ul></dd>";if(null!=n.identity)for(var I=0;I<n.identity.length;I++){n.identity[I].name&&(I<n.identity.length-1?O+=n.identity[I].name+"<em>|</em>":O+=n.identity[I].name)}if(b){var V=a.checkFollowUrl+"?follows="+j;t.ajax({type:"get",url:V,xhrFields:{withCredentials:!0},dataType:"json",success:function(e){var s;200===e.code&&e.data&&(0===e.data[j]?(P="person_deliver person_deliver_letter_un",L="关注",y=!1):(P="person_deliver person_deliver_letter",L="已关注",y=!0)),D=c(h),P&&P&&(s="<a href='javascript:void(0)' class='"+P+"'style='float:right;'>"+L+"</a>"),b===j&&(s=""),o(l,O,d,m,f,p,P,L,N,x,y,D,w,v,s,F),g[j]={},g[j].avatarurl=l,g[j].nickname=d,g[j].isVip=m,g[j].hasDomain=u,g[j].isBlogWriter=f,g[j].favsCount=p,g[j].interestname=O,g[j].followClass=P,g[j].followStr=L,g[j].huistr=N,g[j].huicount=x,g[j].flag=y,g[j].age=F,_[j]=g[j],r()}})}else D=c(h),o(l,O,d,m,f,p,P,L,N,x,y,D,w,v,B,F),t("#csdn-userTooltip .person_deliver").click(function(){e.location.href="https://passport.csdn.net/"}),g[j]={},g[j].avatarurl=l,g[j].nickname=d,g[j].isVip=m,g[j].hasDomain=u,g[j].isBlogWriter=f,g[j].favsCount=p,g[j].interestname=O,g[j].huistr=N,g[j].huicount=x,g[j].age=F,_[j]=g[j]}},error:function(e){console.warn(e)}})}var s=s||e.event;return u=t(s.target||s.srcElement),h=t(this),clearTimeout(m),clearTimeout(p),null!=t(this).attr("username")&&(p=setTimeout(l,200)),t(this).attr("followtype")&&(n=t(this).attr("followtype")),!1}),t(s).on("mouseleave","img[username]",function(e){return clearTimeout(p),m=setTimeout(d,200),!1}),t(s).on("mouseleave","#csdn-userTooltip",function(e){return clearTimeout(m),d(),!1})}}(window,document,jQuery),$(function(){window.csdn.userTooltip()});